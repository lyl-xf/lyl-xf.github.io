(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{361:function(a,s,n){"use strict";n.r(s);var e=n(14),t=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"运行后端代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#运行后端代码"}},[a._v("#")]),a._v(" 运行后端代码")]),a._v(" "),s("h2",{attrs:{id:"下载代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下载代码"}},[a._v("#")]),a._v(" 下载代码")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/liuyulet/lana-iot",target:"_blank",rel:"noopener noreferrer"}},[a._v("GitHub - liuyulet/lana-iot"),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("下载完成之后进入项目目录可以看到以下结构：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("|----lana               \n|----doc                #文档\n|----lana-abutment      #设备接入模块\n|----lana-base          #基础功能模块\n|----lana-device        #设备管理模块\n|----lana-rules         #规则管理模块\n|----lana-service       #主服务模块\n|----lana-system        #系统管理模块\n.....                   #待归化模块\n|----lana-web           #前端项目\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br")])]),s("ul",[s("li",[a._v("lana为整个项目的根目录，也是后端的根目录，直接使用后端编辑器打开lana项目即可。")]),a._v(" "),s("li",[a._v("其中lana-web为前端项目，需要单独独拷贝出去编译，并启动。")])]),a._v(" "),s("h2",{attrs:{id:"初始化数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初始化数据库"}},[a._v("#")]),a._v(" 初始化数据库：")]),a._v(" "),s("h3",{attrs:{id:"_1、初始化mysql数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、初始化mysql数据库"}},[a._v("#")]),a._v(" 1、初始化mysql数据库")]),a._v(" "),s("ul",[s("li",[a._v("连接到mysql数据库，创建数据库lana-boot。")]),a._v(" "),s("li",[a._v("运行sql文件：doc/mysql/lana-boot.sql")])]),a._v(" "),s("h3",{attrs:{id:"_2、初始化tdengine数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、初始化tdengine数据库"}},[a._v("#")]),a._v(" 2、初始化TDengine数据库")]),a._v(" "),s("p",[a._v("可以使用TDengineGUI，也可以通过命令行来操作，下面介绍的是命令行的方式：")]),a._v(" "),s("ul",[s("li",[a._v("命令行进入taos界面")])]),a._v(" "),s("p",[s("img",{attrs:{src:"/showImg/TdengineInit.png",alt:""}})]),a._v(" "),s("ul",[s("li",[s("p",[a._v("找到文件：doc/TDengine/TD.sql")])]),a._v(" "),s("li",[s("p",[a._v("使用建表语句（这里存储时长是3650天，可自行修改）：")])]),a._v(" "),s("li")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("CREATE DATABASE lana PRECISION 'ms' KEEP 3650 DURATION 10 BUFFER 16;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:"/showImg/TDCreatedDatabase.png",alt:""}})]),a._v(" "),s("ul",[s("li",[a._v("使用刚刚创建的lana数据库：")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("use lana;\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("ul",[s("li",[a._v("创建日志超级表，建表语句如下：")])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("CREATE STABLE sys_log_operate (ts timestamp,\n    module NCHAR(200),\n    name NCHAR(100),\n    req_uri NCHAR(200),\n    req_method NCHAR(200),\n    req_params NCHAR(4000),\n    ip NCHAR(50),\n    user_agent NCHAR(300),\n    operate_type INT,\n    status INT,\n    real_name NCHAR(50)\n    ) TAGS (user_id BIGINT);\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br")])]),s("ul",[s("li",[a._v("查看表是否存在")])]),a._v(" "),s("p",[s("img",{attrs:{src:"/showImg/TDTables.png",alt:""}})]),a._v(" "),s("h2",{attrs:{id:"配置后端环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置后端环境"}},[a._v("#")]),a._v(" 配置后端环境")]),a._v(" "),s("h3",{attrs:{id:"_1、使用编辑器打开lana项目-配置mavne"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、使用编辑器打开lana项目-配置mavne"}},[a._v("#")]),a._v(" 1、使用编辑器打开lana项目，配置mavne")]),a._v(" "),s("p",[s("img",{attrs:{src:"/showImg/runSetMaven.png",alt:""}})]),a._v(" "),s("p",[a._v("配置好之后，请使用maven编译项目，确保项目可以编译通过（先clena，后install）。\n"),s("img",{attrs:{src:"/showImg/mavenclean.png",alt:""}})]),a._v(" "),s("h3",{attrs:{id:"_2、修改本项目的sdk版本信息-确保和后端要求的sdk版本一致"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、修改本项目的sdk版本信息-确保和后端要求的sdk版本一致"}},[a._v("#")]),a._v(" 2、修改本项目的sdk版本信息，确保和后端要求的sdk版本一致")]),a._v(" "),s("p",[s("img",{attrs:{src:"/showImg/updateSdk.png",alt:""}})]),a._v(" "),s("h2",{attrs:{id:"修改配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改配置文件"}},[a._v("#")]),a._v(" 修改配置文件")]),a._v(" "),s("h3",{attrs:{id:"_1、修改application-yml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、修改application-yml"}},[a._v("#")]),a._v(" 1、修改application.yml")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("文件位置：\nlana-server/src/main/resources/application.yml")])]),a._v(" "),s("li",[s("p",[a._v("主要关注以下配置：")])])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("# Tomcat\nserver:\n  port: 8888\n  servlet:\nspring:\n  # 环境 dev|test|prod\n  profiles:\n    active: dev\n    \n    ....\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br")])]),s("h3",{attrs:{id:"_1、修改application-dev-yml-上面的配置中-active为-dev"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、修改application-dev-yml-上面的配置中-active为-dev"}},[a._v("#")]),a._v(" 1、修改application-dev.yml（上面的配置中，active为：dev）")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("文件位置：\nlana-server/src/main/resources/application-dev.yml")])]),a._v(" "),s("li",[s("p",[a._v("主要关注以下配置（将：文件存储minio配置、redis配置、数据库‘mysql’、‘TDengine’配置 更换为自己部署的信息。）：")])])]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("# 文件存储\nstorage:\n  minio: #这里修改为自己的minio配置信息\n    access-key: Y2j5CsWVssdsdsdkTYjhR\n    secret-key: ro2TfKWjV07JrbuOTXBhT1XEq0R1dfdfdfQNXRY\n    end-point: http://127.0.0.1:9000\n    bucket-name: dev\nspring:\n  # 是否开启登录验证码\n  captchaEnabled: true\n# redis\n  data:\n    redis:\n      database: 1\n      host: 127.0.0.1\n      port: 6379\n      password: 123456\n      #timeout: 6000ms  # 连接超时时长（毫秒）\n# 数据库    \n  datasource:\n    dynamic:\n      hikari: # Hikari 连接池全局配置\n        connection-timeout: 30000     # 等待连接池分配链接的最大时长（毫秒），超过这个时长还没有可用的连接则发生 SQLException，默认：30 秒\n        minimum-idle: 2               # 最小空闲连接数\n        maximum-pool-size: 10         # 最大连接数\n        idle-timeout: 600000          # 连接超时的最大时长（毫秒），超时则被释放（retired），默认：10 分钟\n        max-lifetime: 1800000         # 连接的生命时长（毫秒），超时而且没被使用则被释放（retired），默认： 30 分钟\n        connection-test-query: SELECT 1\n      primary: mysql\n      datasource:\n        mysql:\n          # MySQL8\n          driver-class-name: com.mysql.cj.jdbc.Driver\n          url: jdbc:mysql://127.0.0.1:3306/lana-boot?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai&nullCatalogMeansCurrent=true\n          username: root\n          password: 123456\n          # TDengine\n        tdengine:\n          #原生链接，需要配置客户端\n          #driver-class-name: com.taosdata.jdbc.TSDBDriver\n          #url: jdbc:TAOS://127.0.0.1:6041/lana?charset=UTF-8&locale=en_US.UTF-8&timezone=UTC-8\n          #REST 连接\n          driver-class-name: com.taosdata.jdbc.rs.RestfulDriver\n          url: jdbc:TAOS-RS://127.0.0.1:6041/lana?charset=UTF-8&locale=en_US.UTF-8&timezone=UTC-8\n          username: root\n          password: 123456\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br"),s("span",{staticClass:"line-number"},[a._v("32")]),s("br"),s("span",{staticClass:"line-number"},[a._v("33")]),s("br"),s("span",{staticClass:"line-number"},[a._v("34")]),s("br"),s("span",{staticClass:"line-number"},[a._v("35")]),s("br"),s("span",{staticClass:"line-number"},[a._v("36")]),s("br"),s("span",{staticClass:"line-number"},[a._v("37")]),s("br"),s("span",{staticClass:"line-number"},[a._v("38")]),s("br"),s("span",{staticClass:"line-number"},[a._v("39")]),s("br"),s("span",{staticClass:"line-number"},[a._v("40")]),s("br"),s("span",{staticClass:"line-number"},[a._v("41")]),s("br"),s("span",{staticClass:"line-number"},[a._v("42")]),s("br"),s("span",{staticClass:"line-number"},[a._v("43")]),s("br"),s("span",{staticClass:"line-number"},[a._v("44")]),s("br"),s("span",{staticClass:"line-number"},[a._v("45")]),s("br"),s("span",{staticClass:"line-number"},[a._v("46")]),s("br")])]),s("h2",{attrs:{id:"启动后端程序"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动后端程序"}},[a._v("#")]),a._v(" 启动后端程序")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("找到LanaServerApplication启动文件（lana-server/src/main/java/com/lana/LanaServerApplication）")])]),a._v(" "),s("li",[s("p",[a._v("右键,选择： Run 'LanaServerAppl....mian()'，即可启动项目")])]),a._v(" "),s("li",[s("p",[a._v("启动效果：\n"),s("img",{attrs:{src:"/showImg/lanaStart.png",alt:""}})])])])])}),[],!1,null,null,null);s.default=t.exports}}]);