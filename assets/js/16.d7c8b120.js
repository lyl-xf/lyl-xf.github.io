(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{371:function(s,a,n){"use strict";n.r(a);var e=n(14),t=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"运行后端代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行后端代码"}},[s._v("#")]),s._v(" 运行后端代码")]),s._v(" "),a("h2",{attrs:{id:"下载代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载代码"}},[s._v("#")]),s._v(" 下载代码")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/lyl-xf/sana",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub - lyl-xf/sana"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("下载完成之后进入项目目录可以看到以下结构：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("|----sana               \n|----doc                #文档\n|----sana-abutment      #设备接入模块\n|----sana-base          #基础功能模块\n|----sana-devices       #设备管理模块\n|----sana-rules         #规则管理模块\n|----sana-service       #主服务模块\n|----sana-system        #系统管理模块\n.....                   #待归化模块\n|----sana-web           #前端项目\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("ul",[a("li",[s._v("sana为整个项目的根目录，也是后端的根目录，直接使用后端编辑器打开sana项目即可。")]),s._v(" "),a("li",[s._v("其中sana-web为前端项目，需要单独独拷贝出去编译，并启动。")])]),s._v(" "),a("h2",{attrs:{id:"初始化数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初始化数据库"}},[s._v("#")]),s._v(" 初始化数据库：")]),s._v(" "),a("h3",{attrs:{id:"_1、初始化mysql数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、初始化mysql数据库"}},[s._v("#")]),s._v(" 1、初始化mysql数据库")]),s._v(" "),a("ul",[a("li",[s._v("连接到mysql数据库，创建数据库sana。")]),s._v(" "),a("li",[s._v("运行sql文件：doc/mysql/sana.sql")])]),s._v(" "),a("h3",{attrs:{id:"_2、初始化tdengine数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、初始化tdengine数据库"}},[s._v("#")]),s._v(" 2、初始化TDengine数据库")]),s._v(" "),a("p",[s._v("可以使用TDengineGUI，也可以通过命令行来操作，下面介绍的是命令行的方式：")]),s._v(" "),a("ul",[a("li",[s._v("命令行进入taos界面")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/showImg/TdengineInit.png",alt:""}})]),s._v(" "),a("ul",[a("li",[a("p",[s._v("找到文件：doc/TDengine/TD.sql")])]),s._v(" "),a("li",[a("p",[s._v("使用建表语句（这里存储时长是3650天，可自行修改）：")])]),s._v(" "),a("li")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("CREATE DATABASE sana PRECISION 'ms' KEEP 3650 DURATION 10 BUFFER 16;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/showImg/TDCreatedDatabase.png",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("使用刚刚创建的sana数据库：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("use sana;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("创建日志超级表，建表语句如下：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("CREATE STABLE sys_log_operate (ts timestamp,\n    module NCHAR(200),\n    name NCHAR(100),\n    req_uri NCHAR(200),\n    req_method NCHAR(200),\n    req_params NCHAR(4000),\n    ip NCHAR(50),\n    user_agent NCHAR(300),\n    operate_type INT,\n    status INT,\n    real_name NCHAR(50)\n    ) TAGS (user_id BIGINT);\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("ul",[a("li",[s._v("查看表是否存在")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/showImg/TDTables.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"配置后端环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置后端环境"}},[s._v("#")]),s._v(" 配置后端环境")]),s._v(" "),a("h3",{attrs:{id:"_1、使用编辑器打开sana项目-配置mavne"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、使用编辑器打开sana项目-配置mavne"}},[s._v("#")]),s._v(" 1、使用编辑器打开sana项目，配置mavne")]),s._v(" "),a("p",[a("img",{attrs:{src:"/showImg/runSetMaven.png",alt:""}})]),s._v(" "),a("p",[s._v("配置好之后，请使用maven编译项目，确保项目可以编译通过（先clena，后install）。\n"),a("img",{attrs:{src:"/showImg/mavenclean.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"_2、修改本项目的sdk版本信息-确保和后端要求的sdk版本一致"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、修改本项目的sdk版本信息-确保和后端要求的sdk版本一致"}},[s._v("#")]),s._v(" 2、修改本项目的sdk版本信息，确保和后端要求的sdk版本一致")]),s._v(" "),a("p",[a("img",{attrs:{src:"/showImg/updateSdk.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"修改配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改配置文件"}},[s._v("#")]),s._v(" 修改配置文件")]),s._v(" "),a("h3",{attrs:{id:"_1、修改application-yml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、修改application-yml"}},[s._v("#")]),s._v(" 1、修改application.yml")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("文件位置：\nsana-server/src/main/resources/application.yml")])]),s._v(" "),a("li",[a("p",[s._v("主要关注以下配置：")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# Tomcat\nserver:\n  port: 8888\n  servlet:\nspring:\n  # 环境 dev|test|prod\n  profiles:\n    active: dev\n    \n    ....\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h3",{attrs:{id:"_1、修改application-dev-yml-上面的配置中-active为-dev"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、修改application-dev-yml-上面的配置中-active为-dev"}},[s._v("#")]),s._v(" 1、修改application-dev.yml（上面的配置中，active为：dev）")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("文件位置：\nsana-server/src/main/resources/application-dev.yml")])]),s._v(" "),a("li",[a("p",[s._v("主要关注以下配置（将：文件存储minio配置、redis配置、数据库‘mysql’、‘TDengine’配置 更换为自己部署的信息。）：")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("############## Sa-Token 配置 (文档: https://sa-token.cc) ##############\nsa-token:\n  cookie:\n    secure: false\n    httpOnly: true\n  token-name: Authorization # token 名称（同时也是 cookie 名称）\n  timeout: 2592000  # token 有效期（单位：秒） 默认30天，-1 代表永久有效\n  active-timeout: -1  # token 最低活跃频率（单位：秒），如果 token 超过此时间没有访问系统就会被冻结，默认-1 代表不限制，永不冻结\n  is-concurrent: true  # 是否允许同一账号多地同时登录 （为 true 时允许一起登录, 为 false 时新登录挤掉旧登录）\n  is-share: false  # 在多人登录同一账号时，是否共用一个 token （为 true 时所有登录共用一个 token, 为 false 时每次登录新建一个 token）\n  token-style: uuid  # token 风格（默认可取值：uuid、simple-uuid、random-32、random-64、random-128、tik）\n  is-log: true  # 是否输出操作日志\n  jwt-secret-key: sanakeyidSDWsdjnusadFaaDWedwfdasefAS # jwt秘钥\n  ignore-config:\n    paths:\n      - /swagger/**\n      - /swagger-resources/**\n      - /swagger-ui.html\n      - /doc.html\n      - /swagger-ui/**\n      - /favicon.ico\n# 文件存储\nstorage:\n  minio:\n    access-key: Y2j5CZqWkTYjhRsadas\n    secret-key: ro2TfKWjV07uOTXBqp5PGzzRQNsadasXRY\n    end-point: http://127.0.0.1:9000\n    bucket-name: dev\n\nspring:\n  # 是否开启登录验证码\n  captchaEnabled: true\n  # 数据库连接信心\n  data:\n    redis:\n      database: 1\n      host: 127.0.0.1\n      port: 6379\n      password: 123456\n      timeout: 6000ms  # 连接超时时长（毫秒）\n      lettuce:\n        pool:\n          max-active: 20    # 最大活跃连接数\n          max-idle: 10      # 最大空闲连接\n          min-idle: 5       # 最小空闲连接\n          max-wait: 5000ms  # 获取连接最大等待时间\n          time-between-eviction-runs: 30000ms  # 空闲连接检查周期\n      stream:\n        core-pool-size: 3 #处理逻辑时线程池的核心线程数\n        max-pool-size: 3  #线程池最大线程数\n        queue-capacity: 500 # 队列容量，默认：500\n        batch-size: 40    #批量消费数量(一次最多获取多少条消息)\n        poll-timeout-seconds: 3 # Stream中没有消息时，等待时间\n        streams:          # 环境运行的时候，请一定要先创建好对应的stream；\n          - name: sana:stream:topic-ruleo  # 设备规则处理stream1\n            group: group-rule1\n          - name: sana:stream:topic-rulet  # 设备规则处理stream2\n            group: group-rule2\n          - name: sana:stream:topic-rulej  # 定时规则处理stream\n            group: group-rulejob\n  datasource:\n    dynamic:\n      hikari: # Hikari 连接池全局配置\n        connection-timeout: 30000     # 等待连接池分配链接的最大时长（毫秒），超过这个时长还没有可用的连接则发生 SQLException，默认：30 秒\n        minimum-idle: 2               # 最小空闲连接数\n        maximum-pool-size: 10         # 最大连接数\n        idle-timeout: 600000          # 连接超时的最大时长（毫秒），超时则被释放（retired），默认：10 分钟\n        max-lifetime: 1800000         # 连接的生命时长（毫秒），超时而且没被使用则被释放（retired），默认： 30 分钟\n        connection-test-query: SELECT 1\n      primary: mysql\n      datasource:\n        mysql:\n          # MySQL8\n          driver-class-name: com.mysql.cj.jdbc.Driver\n          url: jdbc:mysql://127.0.0.1:3306/sana?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai&nullCatalogMeansCurrent=true\n          username: root\n          password: 123456\n          # TDengine\n        tdengine:\n          #原生链接，需要配置客户端\n          #driver-class-name: com.taosdata.jdbc.TSDBDriver\n          #url: jdbc:TAOS://127.0.0.1:6041/sana?charset=UTF-8&locale=en_US.UTF-8&timezone=UTC-8\n          #REST 连接\n          driver-class-name: com.taosdata.jdbc.rs.RestfulDriver\n          url: jdbc:TAOS-RS://127.0.0.1:6041/sana?charset=UTF-8&locale=en_US.UTF-8&timezone=UTC-8\n          username: root\n          password: admin1234...\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br")])]),a("h2",{attrs:{id:"启动后端程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动后端程序"}},[s._v("#")]),s._v(" 启动后端程序")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("找到SanaServerApplication启动文件（sana-server/src/main/java/com/sana/SanaServerApplication）")])]),s._v(" "),a("li",[a("p",[s._v("右键,选择： Run 'SanaServerAppl....mian()'，即可启动项目")])]),s._v(" "),a("li",[a("p",[s._v("启动效果：\n"),a("img",{attrs:{src:"/showImg/lanaStart.png",alt:""}})])])])])}),[],!1,null,null,null);a.default=t.exports}}]);